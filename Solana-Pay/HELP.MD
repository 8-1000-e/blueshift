# üéì Guide d'Apprentissage - Solana Pay (Blueshift)

## Tu es d√©butant complet ? Pas de panique !

Ce guide va t'accompagner √©tape par √©tape pour comprendre et r√©ussir les exercices du cours Solana Pay sur Blueshift. Je ne te donne pas le code directement - je t'explique les concepts et te guide pour que tu apprennes vraiment.

---

## üìö √âTAPE 0 : Pr√©requis √† installer

Avant de commencer, assure-toi d'avoir :

### 1. Node.js
```bash
# V√©rifie si tu l'as
node --version

# Si non, t√©l√©charge sur https://nodejs.org (version LTS)
```

### 2. Un √©diteur de code
- **VS Code** (recommand√©) : https://code.visualstudio.com
- Extensions utiles : "Solana" et "TypeScript"

### 3. Un wallet Solana (pour tester)
- **Phantom** : https://phantom.app
- Mets-le en mode "Devnet" dans les settings

### 4. Cr√©er ton projet
```bash
# Cr√©e un dossier
mkdir solana-pay-learning
cd solana-pay-learning

# Initialise le projet
npm init -y

# Installe TypeScript
npm install typescript ts-node @types/node --save-dev

# Cr√©e le fichier de config TypeScript
npx tsc --init
```

### 5. Installer les d√©pendances Solana
```bash
npm install @solana/web3.js @solana/pay bignumber.js
```

---

## üß† LE√áON 1 : Comprendre les bases

### C'est quoi Solana Pay ?

Imagine que tu veux recevoir un paiement. Traditionnellement :
```
Client ‚Üí Banque ‚Üí Processeur (Stripe/PayPal) ‚Üí Ta banque ‚Üí Toi
         ‚Üë              ‚Üë                         ‚Üë
       D√©lai         Frais 2-3%               2-3 jours
```

Avec Solana Pay :
```
Client ‚Üí Toi
    ‚Üë
  Instantan√©, ~0.00025$ de frais
```

### Les 2 types de requ√™tes

| Type | C'est quoi | Exemple |
|------|------------|---------|
| **Transfer Request** | Tout est dans l'URL, simple | "Paie 5$ √† cette adresse" |
| **Transaction Request** | Le serveur construit la transaction | "Ach√®te ce NFT au prix actuel" |

### L'URL Solana Pay - Anatomie

```
solana:<DESTINATAIRE>?amount=<MONTANT>&label=<NOM>&message=<MESSAGE>
```

**D√©composition :**
- `solana:` ‚Üí Le protocole (comme `https:`)
- `<DESTINATAIRE>` ‚Üí L'adresse publique qui re√ßoit
- `amount` ‚Üí Combien (en SOL ou tokens)
- `label` ‚Üí Qui demande le paiement
- `message` ‚Üí Pourquoi

---

## üîß EXERCICE 1 : G√©n√©rer une Keypair

### Objectif
Cr√©er ta premi√®re adresse Solana en TypeScript.

### Ce que tu dois comprendre

Une **Keypair** c'est :
- Une **cl√© publique** = ton adresse (comme un IBAN)
- Une **cl√© priv√©e** = ton mot de passe (NE JAMAIS PARTAGER)

### Indices pour y arriver

1. Tu dois importer `Keypair` depuis `@solana/web3.js`
2. La m√©thode pour g√©n√©rer une nouvelle keypair s'appelle... `generate()` ü§î
3. Pour afficher la cl√© publique, il y a une propri√©t√© `.publicKey`
4. Pour la convertir en texte lisible, utilise `.toBase58()`

### Structure de ton fichier

Cr√©e `exercice1.ts` :
```typescript
// 1. Importe Keypair depuis @solana/web3.js
// √âCRIS TON IMPORT ICI

// 2. G√©n√®re une nouvelle keypair
// √âCRIS TON CODE ICI

// 3. Affiche la cl√© publique
// √âCRIS TON CODE ICI
```

### Pour ex√©cuter
```bash
npx ts-node exercice1.ts
```

### R√©sultat attendu
Tu devrais voir quelque chose comme :
```
Cl√© publique : 7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU
```

### ‚ùì Bloqu√© ?
<details>
<summary>Indice 1</summary>
L'import ressemble √† : `import { Keypair } from "@solana/web3.js";`
</details>

<details>
<summary>Indice 2</summary>
Pour g√©n√©rer : `const keypair = Keypair.generate();`
</details>

---

## üîß EXERCICE 2 : Cr√©er une URL de Transfer Request

### Objectif
Cr√©er un lien de paiement Solana Pay.

### Ce que tu dois comprendre

L'URL encode toutes les infos du paiement :
- Qui re√ßoit ?
- Combien ?
- Pourquoi ?

### Indices pour y arriver

1. Tu dois importer `encodeURL` depuis `@solana/pay`
2. Tu as besoin d'un `PublicKey` pour le destinataire
3. Le montant utilise `BigNumber` (pas un simple number)
4. La fonction `encodeURL()` prend un objet avec les param√®tres

### Les param√®tres possibles

| Param√®tre | Type | Obligatoire | Description |
|-----------|------|-------------|-------------|
| `recipient` | PublicKey | ‚úÖ | Qui re√ßoit le paiement |
| `amount` | BigNumber | ‚ùå | Montant en SOL |
| `label` | string | ‚ùå | Nom du marchand |
| `message` | string | ‚ùå | Description |
| `memo` | string | ‚ùå | Note on-chain |
| `reference` | PublicKey | ‚ùå | ID unique pour tracker |

### Structure de ton fichier

Cr√©e `exercice2.ts` :
```typescript
// 1. Imports n√©cessaires
// - Keypair, PublicKey depuis @solana/web3.js
// - encodeURL depuis @solana/pay
// - BigNumber depuis bignumber.js

// 2. Cr√©e ou utilise une adresse de destinataire
// Tu peux utiliser ta keypair de l'exercice 1
// Ou une adresse en dur pour tester

// 3. D√©finis les param√®tres du paiement
// - recipient: l'adresse
// - amount: utilise new BigNumber(0.01) pour 0.01 SOL
// - label: "Mon Magasin"
// - message: "Merci pour ton achat !"

// 4. G√©n√®re l'URL avec encodeURL()

// 5. Affiche l'URL
```

### R√©sultat attendu
```
URL Solana Pay : solana:7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU?amount=0.01&label=Mon+Magasin&message=Merci+pour+ton+achat+%21
```

### ‚ùì Bloqu√© ?
<details>
<summary>Indice : structure de encodeURL</summary>

```typescript
const url = encodeURL({
  recipient: new PublicKey("..."),
  amount: new BigNumber(0.01),
  label: "...",
  message: "...",
});
```
</details>

---

## üîß EXERCICE 3 : G√©n√©rer un QR Code

### Objectif
Transformer ton URL en QR code scannable.

### Ce que tu dois comprendre

Un QR code c'est juste une fa√ßon visuelle d'encoder une URL.
Le wallet Phantom peut scanner ce QR et lire l'URL Solana Pay.

### Indices pour y arriver

1. Importe `createQR` depuis `@solana/pay`
2. `createQR()` prend l'URL et des options (taille, couleur)
3. Le QR peut √™tre sauvegard√© en fichier ou affich√©

### Structure de ton fichier

Cr√©e `exercice3.ts` :
```typescript
// 1. Reprends le code de l'exercice 2 pour g√©n√©rer l'URL

// 2. Importe createQR depuis @solana/pay

// 3. Cr√©e le QR code
// createQR(url, taille, couleurFond)
// Exemple de taille : 400
// Couleur de fond : "white" ou "transparent"

// 4. Pour sauvegarder le QR en fichier PNG
// Tu auras besoin de la m√©thode .getRawData('png')
// Et du module 'fs' pour √©crire le fichier
```

### Pour tester
1. G√©n√®re le QR code
2. Ouvre-le avec une app de visualisation
3. Scanne-le avec Phantom (en mode Devnet)
4. Tu devrais voir la demande de paiement !

### ‚ùì Bloqu√© ?
<details>
<summary>Indice : cr√©er et sauvegarder le QR</summary>

```typescript
import { writeFile } from 'fs/promises';

const qr = createQR(url, 400, "white");
const qrBuffer = await qr.getRawData('png');
await writeFile('qrcode.png', qrBuffer);
```
</details>

---

## üîß EXERCICE 4 : Utiliser une Reference

### Objectif
Comprendre et utiliser le syst√®me de `reference` pour tracker les paiements.

### Ce que tu dois comprendre

**Le probl√®me** : Comment savoir si quelqu'un a pay√© ?
- On n'a pas la signature de transaction
- On ne sait pas quand √ßa va arriver

**La solution** : La `reference`
- C'est une cl√© publique unique qu'on ajoute √† la transaction
- On peut ensuite chercher "toutes les transactions qui contiennent cette reference"

### Le flux

```
1. Tu g√©n√®res une reference unique (une Keypair)
2. Tu l'ajoutes √† l'URL Solana Pay
3. Le client paie ‚Üí la reference est incluse dans la transaction
4. Tu polls le r√©seau pour trouver une transaction avec cette reference
5. Tu trouves ‚Üí le client a pay√© !
```

### Indices pour y arriver

1. G√©n√®re une nouvelle `Keypair` pour la reference
2. Ajoute `.publicKey` comme param√®tre `reference` dans `encodeURL()`
3. Utilise `findReference` de `@solana/pay` pour chercher la transaction

### Structure de ton fichier

Cr√©e `exercice4.ts` :
```typescript
// 1. Imports
// - Connection, Keypair, PublicKey de @solana/web3.js
// - encodeURL, findReference de @solana/pay
// - BigNumber

// 2. Connexion au r√©seau (devnet)
// new Connection(clusterApiUrl("devnet"), "confirmed")

// 3. G√©n√®re une reference unique
// C'est juste une Keypair dont tu utilises la publicKey

// 4. Cr√©e l'URL avec la reference

// 5. Affiche l'URL et le QR

// 6. Boucle qui cherche la transaction
// Utilise setInterval pour v√©rifier toutes les secondes
// findReference(connection, reference) va chercher

// 7. Quand trouv√©, affiche "Paiement re√ßu !"
```

### ‚ùì Bloqu√© ?
<details>
<summary>Indice : structure de findReference</summary>

```typescript
try {
  const signatureInfo = await findReference(connection, reference, {
    finality: "confirmed",
  });
  console.log("Paiement trouv√© !", signatureInfo.signature);
} catch (e) {
  // Pas encore trouv√©, on r√©essaie
}
```
</details>

---

## üîß EXERCICE 5 : Transaction Request (Avanc√©)

### Objectif
Cr√©er un serveur qui g√©n√®re des transactions dynamiques.

### Ce que tu dois comprendre

Contrairement au Transfer Request (tout dans l'URL), ici :
1. L'URL pointe vers ton serveur
2. Le wallet fait une requ√™te HTTP √† ton serveur
3. Ton serveur construit et renvoie une transaction
4. Le wallet la signe et l'envoie

### Pourquoi c'est utile ?
- Prix dynamiques
- Logique m√©tier complexe
- NFT minting
- Programmes de fid√©lit√©

### Le protocole

**GET** `/api/pay`
‚Üí Renvoie des infos d'affichage (label, icon)

**POST** `/api/pay`
‚Üí Re√ßoit l'adresse du client, renvoie la transaction √† signer

### Ce dont tu as besoin

1. Un framework web (Next.js, Express, ou Hono)
2. G√©rer les CORS (obligatoire pour les wallets)
3. Construire une Transaction Solana

### Structure de base

```typescript
// Route GET - Infos d'affichage
// Renvoie { label: "...", icon: "..." }

// Route POST - Construction de la transaction
// 1. R√©cup√®re l'adresse du client dans le body
// 2. Connecte-toi au r√©seau pour avoir le blockhash
// 3. Cr√©e une Transaction avec le client comme feePayer
// 4. Ajoute tes instructions (transfert, etc.)
// 5. S√©rialise et renvoie la transaction
```

### ‚ùì Bloqu√© ?
<details>
<summary>Indice : structure de la r√©ponse POST</summary>

```typescript
// La transaction doit √™tre s√©rialis√©e en base64
const serialized = transaction.serialize({
  requireAllSignatures: false,
  verifySignatures: false,
});
const base64 = serialized.toString('base64');

// R√©ponse
return { transaction: base64 };
```
</details>

---

## üìù CHECKLIST DE PROGRESSION

- [ ] J'ai install√© Node.js et les d√©pendances
- [ ] J'ai cr√©√© mon premier wallet (Keypair)
- [ ] Je comprends la diff√©rence cl√© publique / cl√© priv√©e
- [ ] J'ai cr√©√© une URL de Transfer Request
- [ ] J'ai g√©n√©r√© un QR code
- [ ] Je comprends le concept de Reference
- [ ] J'ai impl√©ment√© la d√©tection de paiement avec findReference
- [ ] (Bonus) J'ai cr√©√© un endpoint de Transaction Request

---

## üÜò RESSOURCES SI TU BLOQUES

### Documentation officielle
- Solana Pay : https://docs.solanapay.com
- Solana Web3.js : https://solana-labs.github.io/solana-web3.js

### Erreurs courantes

| Erreur | Solution |
|--------|----------|
| `Cannot find module '@solana/pay'` | `npm install @solana/pay` |
| `BigNumber is not a constructor` | `import BigNumber from 'bignumber.js'` |
| `Connection refused` | V√©rifie que tu es en devnet |
| `FindReferenceError` | Normal si pas de paiement, continue √† poll |

### Pour tester sans d√©penser de vrai SOL
1. Mets Phantom en mode **Devnet**
2. Va sur https://faucet.solana.com
3. Demande des SOL de test gratuits

---

## üéØ NEXT STEPS

Une fois ces exercices termin√©s, tu peux :

1. **Int√©grer dans une vraie app** - Ajoute Solana Pay √† un site web
2. **Cr√©er des paiements en tokens** - Utilise le param√®tre `spl-token`
3. **Construire un Point of Sale** - Interface compl√®te pour marchands
4. **Explorer les Transaction Requests** - Logique serveur avanc√©e

---

## üí¨ CONSEILS FINAUX

1. **Ne copie pas** - Tape le code toi-m√™me, m√™me si c'est lent
2. **Exp√©rimente** - Change les valeurs, casse des trucs, r√©pare
3. **Lis les erreurs** - Elles te disent exactement le probl√®me
4. **Une √©tape √† la fois** - Ne passe pas √† la suite tant que tu comprends pas

Bonne chance ! üöÄ